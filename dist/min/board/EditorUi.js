/* 2017-11-21 */
EditorUi.prototype.maxImageSize=520,EditorUi.prototype.maxImageBytes=1e6;var editorUiInit=EditorUi.prototype.init;EditorUi.prototype.init=function(){function t(){window.setTimeout(function(){i.innerHTML="&nbsp;",i.focus(),document.execCommand("selectAll",!1,null)},0)}editorUiInit.apply(this,arguments);var e=this.editor.graph;if(!this.editor.chromeless){var i=document.createElement("div");i.style.position="absolute",i.style.whiteSpace="nowrap",i.style.overflow="hidden",i.style.display="block",i.contentEditable=!0,mxUtils.setOpacity(i,0),i.style.width="1px",i.style.height="1px",i.innerHTML="&nbsp;";var n=!1;this.keyHandler.bindControlKey(88,null),this.keyHandler.bindControlKey(67,null),this.keyHandler.bindControlKey(86,null),e.container.addEventListener("paste",mxUtils.bind(this,function(t){var e=this.editor.graph;if(!mxEvent.isConsumed(t))try{for(var i=t.clipboardData||t.originalEvent.clipboardData,n=!1,l=0;l<i.types.length;l++)if("text/"===i.types[l].substring(0,5)){n=!0;break}if(!n){var s=i.items;for(index in s){var r=s[index];if("file"===r.kind){if(e.isEditing())this.importFiles([r.getAsFile()],0,0,this.maxImageSize,function(t,i,n,l,s,r){e.insertImage(t,s,r)},function(){},function(t){return"image/"==t.type.substring(0,6)},function(t){for(var e=0;e<t.length;e++)t[e]()});else{var o=this.editor.graph.getInsertPoint();this.snapshoot(),this.importFiles([r.getAsFile()],o.x,o.y,this.maxImageSize),mxEvent.consume(t)}break}}}}catch(t){console.error(t)}}),!1),mxEvent.addListener(document,"keydown",mxUtils.bind(this,function(t){var l=mxEvent.getSource(t);null==e.container||!e.isEnabled()||e.isMouseDown||e.isEditing()||null!=this.dialog||"INPUT"==l.nodeName||"TEXTAREA"==l.nodeName||(224==t.keyCode||!mxClient.IS_MAC&&17==t.keyCode||mxClient.IS_MAC&&91==t.keyCode)&&(n||(i.style.left=e.container.scrollLeft+10+"px",i.style.top=e.container.scrollTop+10+"px",e.container.appendChild(i),n=!0,mxClient.IS_QUIRKS?window.setTimeout(function(){i.focus(),document.execCommand("selectAll",!1,null)},0):(i.focus(),document.execCommand("selectAll",!1,null))))})),mxEvent.addListener(document,"keyup",mxUtils.bind(this,function(t){var l=t.keyCode;window.setTimeout(mxUtils.bind(this,function(){!n||224!=l&&17!=l&&91!=l||(n=!1,e.isEditing()||null!=this.dialog||null==e.container||e.container.focus(),i.parentNode.removeChild(i))}),0)})),mxEvent.addListener(i,"copy",mxUtils.bind(this,function(n){e.isEnabled()&&(mxClipboard.copy(e),this.copyCells(i),t())})),mxEvent.addListener(i,"cut",mxUtils.bind(this,function(n){e.isEnabled()&&(this.copyCells(i,!0),t())})),mxEvent.addListener(i,"paste",mxUtils.bind(this,function(t){e.isEnabled()&&!e.isCellLocked(e.getDefaultParent())&&(i.innerHTML="&nbsp;",i.focus(),window.setTimeout(mxUtils.bind(this,function(){this.pasteCells(t,i),i.innerHTML="&nbsp;"}),0))}),!0);var l=this.isSelectionAllowed;this.isSelectionAllowed=function(t){return mxEvent.getSource(t)==i||l.apply(this,arguments)}}var s=Math.max(document.body.clientHeight||0,document.documentElement.clientHeight||0)/2,r=document.body.clientWidth/2-2;this.spinner=this.createSpinner(r,s,24)},EditorUi.prototype.copyCells=function(t,e){var i=this.editor.graph;if(i.isSelectionEmpty())t.innerHTML="";else{var n=mxUtils.sortCells(i.model.getTopmostCells(i.getSelectionCells())),l=mxUtils.getXml(this.editor.graph.encodeCells(n));mxUtils.setTextContent(t,encodeURIComponent(l)),e?(i.removeCells(n,!1),i.lastPasteXml=null):(i.lastPasteXml=l,i.pasteCounter=0),t.focus(),document.execCommand("selectAll",!1,null)}},EditorUi.prototype.pasteCells=function(t,e){if(!mxEvent.isConsumed(t)){var i=e.getElementsByTagName("span");if(null!=i&&i.length>0&&"application/vnd.lucid.chart.objects"===i[0].getAttribute("data-lucid-type")){var n=i[0].getAttribute("data-lucid-content");null!=n&&n.length>0&&(this.importLucidChart(n,0,0),mxEvent.consume(t))}else{var l=this.editor.graph,s=mxUtils.trim(mxClient.IS_QUIRKS||8==document.documentMode?mxUtils.getTextContent(e):e.textContent),r=!1;try{var o=s.lastIndexOf("%3E");o>=0&&o<s.length-3&&(s=s.substring(0,o+3))}catch(t){}try{var a=null!=(i=e.getElementsByTagName("span"))&&i.length>0?mxUtils.trim(decodeURIComponent(i[0].textContent)):decodeURIComponent(s);this.isCompatibleString(a)&&(r=!0,s=a)}catch(t){}l.lastPasteXml==s?l.pasteCounter++:(l.lastPasteXml=s,l.pasteCounter=0);var d=l.pasteCounter*l.gridSize;if(null!=s&&s.length>0){if(r||this.isCompatibleString(s))l.setSelectionCells(this.importXml(s,d,d));else{var u=l.getInsertPoint();l.isMouseInsertPoint()&&(d=0,l.lastPasteXml==s&&l.pasteCounter>0&&l.pasteCounter--),l.setSelectionCells(this.insertTextAt(s,u.x+d,u.y+d,!0))}if(!l.isSelectionEmpty()){l.scrollCellToVisible(l.getSelectionCell()),null!=this.hoverIcons&&this.hoverIcons.update(l.view.getState(l.getSelectionCell()));try{mxEvent.consume(t)}catch(t){}}}}}},EditorUi.prototype.isCompatibleString=function(t){try{var e=mxUtils.parseXml(t),i=this.editor.extractGraphModel(e.documentElement,!0);return null!=i&&0==i.getElementsByTagName("parsererror").length}catch(t){console.log(t)}return!1},EditorUi.prototype.insertTextAt=function(t,e,i,n,l,s,r){if(s=null==s||s,r=null==r||r,null!=t){if(Graph.fileSupport&&!this.isOffline()&&(new XMLHttpRequest).upload&&this.isRemoteFileFormat(t))return this.parseFile(new Blob([t.replace(/\s+/g," ")],{type:"application/octet-stream"}),mxUtils.bind(this,function(t){4==t.readyState&&t.status>=200&&t.status<=299&&this.editor.graph.setSelectionCells(this.insertTextAt(t.responseText,e,i,!0))})),[];if("data:"==t.substring(0,5)||!this.isOffline()&&(l||/\.(gif|jpg|jpeg|tiff|png|svg)$/i.test(t))){var o=this.editor.graph;if("data:image/png;base64,"==t.substring(0,22)){a=this.extractGraphModelFromPng(t);if((d=this.importXml(a,e,i,s,!0)).length>0)return d}if("data:image/svg+xml;"==t.substring(0,19))try{var a=null;"data:image/svg+xml;base64,"==t.substring(0,26)?(a=t.substring(t.indexOf(",")+1),a=window.atob&&!mxClient.IS_SF?atob(a):Base64.decode(a,!0)):a=decodeURIComponent(t.substring(t.indexOf(",")+1));var d=this.importXml(a,e,i,s,!0);if(d.length>0)return d}catch(t){}return this.loadImage(t,mxUtils.bind(this,function(n){if("data:"==t.substring(0,5))this.resizeImage(n,t,mxUtils.bind(this,function(t,n,l){o.setSelectionCell(o.insertVertex(null,null,"",o.snap(e),o.snap(i),n,l,"shape=image;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;verticalAlign=top;aspect=fixed;imageAspect=0;image="+this.convertDataUri(t)+";"))}),r,this.maxImageSize);else{var l=Math.min(1,Math.min(this.maxImageSize/n.width,this.maxImageSize/n.height)),s=Math.round(n.width*l),a=Math.round(n.height*l);o.setSelectionCell(o.insertVertex(null,null,"",o.snap(e),o.snap(i),s,a,"shape=image;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;verticalAlign=top;aspect=fixed;imageAspect=0;image="+t+";"))}}),mxUtils.bind(this,function(){var l=null;o.getModel().beginUpdate();try{l=o.insertVertex(o.getDefaultParent(),null,t,o.snap(e),o.snap(i),1,1,"text;"+(n?"html=1;":"")),o.updateCellSize(l),o.fireEvent(new mxEventObject("textInserted","cells",[l]))}finally{o.getModel().endUpdate()}o.setSelectionCell(l)})),[]}if(t=this.editor.graph.zapGremlins(mxUtils.trim(t)),this.isCompatibleString(t))return this.importXml(t,e,i,s);if(t.length>0){if('{"state":"{\\"Properties\\":'!=t.substring(0,26)){var u=null;(o=this.editor.graph).getModel().beginUpdate();try{u=o.insertVertex(o.getDefaultParent(),null,"",o.snap(e),o.snap(i),1,1,"text;"+(n?"html=1;":"")),o.fireEvent(new mxEventObject("textInserted","cells",[u])),u.value=t,o.updateCellSize(u),/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/i.test(u.value)&&o.setLinkForCell(u,u.value),u.geometry.width+=o.gridSize,u.geometry.height+=o.gridSize}finally{o.getModel().endUpdate()}return[u]}this.importLucidChart(t,e,i,s)}}return[]},EditorUi.prototype.importXml=function(t,e,i,n,l){e=null!=e?e:0,i=null!=i?i:0;var s=[];try{var r=this.editor.graph;if(null!=t&&t.length>0){var o=mxUtils.parseXml(t),a=this.editor.extractGraphModel(o.documentElement,null!=this.pages);if(null!=a&&"mxfile"==a.nodeName&&null!=this.pages){var d=a.getElementsByTagName("diagram");if(1==d.length)a=mxUtils.parseXml(r.decompress(mxUtils.getTextContent(d[0]))).documentElement;else if(d.length>1){r.model.beginUpdate();try{for(c=0;c<d.length;c++){var u=this.updatePageRoot(new DiagramPage(d[c])),m=this.pages.length;null==u.getName()&&u.setName(mxResources.get("pageWithNumber",[m+1])),r.model.execute(new ChangePage(this,u,u,m))}}finally{r.model.endUpdate()}}}if(null!=a&&"mxGraphModel"===a.nodeName){var h=new mxGraphModel;new mxCodec(a.ownerDocument).decode(a,h);var p=h.getChildCount(h.getRoot());r.model.getChildCount(r.model.getRoot());r.model.beginUpdate();try{for(var g=new Object,c=0;c<p;c++){var f=h.getChildAt(h.getRoot(),c);if(1!=p||r.isCellLocked(r.getDefaultParent())){f=r.importCells([f],0,0,r.model.getRoot(),null,g)[0];x=r.model.getChildren(f);r.moveCells(x,e,i),s=s.concat(x)}else{var x=h.getChildren(f);s=s.concat(r.importCells(x,e,i,r.getDefaultParent(),null,g))}}if(n){r.isGridEnabled()&&(e=r.snap(e),i=r.snap(i));var v=r.getBoundingBoxFromGeometry(s,!0);null!=v&&r.moveCells(s,e-v.x,i-v.y)}}finally{r.model.endUpdate()}}}}catch(t){throw l||this.handleError(t,mxResources.get("invalidOrMissingFile")),t}return s},EditorUi.prototype.isOfflineApp=function(){return"1"==urlParams.offline},EditorUi.prototype.isOffline=function(){return this.isOfflineApp()||!navigator.onLine||"1"==urlParams.stealth},EditorUi.prototype.isRemoteFileFormat=function(t,e){return/(\.*<graphml xmlns=\".*)/.test(t)||/(\"contentType\":\s*\"application\/gliffy\+json\")/.test(t)||null!=e&&/(\.vsdx)($|\?)/i.test(e)||null!=e&&/(\.vssx)($|\?)/i.test(e)},EditorUi.prototype.getCurrentCompressData=function(){var t=this.editor.getGraphXml();if(t&&t.childNodes[0]&&t.childNodes[0].childNodes.length<=2)return null;var e=mxUtils.getXml(t),i=this.editor.graph.compress(this.editor.graph.zapGremlins(e)),n=document.createElement("div"),l=document.createElement("diagram");return l.innerText=i,l.setAttribute("version",Board.VERSION),n.appendChild(l),n.innerHTML},EditorUi.prototype.importFiles=function(t,e,i,n,l,s,r,o,a,d,u,m){e=null!=e?e:0,i=null!=i?i:0,n=null!=n?n:this.maxImageSize,d=null!=d?d:this.maxImageBytes;var h=null!=e&&null!=i,p=!0,g=!1;if(!mxClient.IS_CHROMEAPP&&null!=t)for(var c=u||this.resampleThreshold,f=0;f<t.length;f++)if("image/"==t[f].type.substring(0,6)&&t[f].size>c){g=!0;break}var x=mxUtils.bind(this,function(){var a=this.editor.graph,g=a.gridSize;if(l=null!=l?l:mxUtils.bind(this,function(t,e,i,n,l,s,r,o,a){return null!=t&&"<mxlibrary"==t.substring(0,10)?(this.spinner.stop(),this.loadLibrary(new LocalLibrary(this,t,r)),null):this.importFile(t,e,i,n,l,s,r,o,a,h,m)}),s=null!=s?s:mxUtils.bind(this,function(t){a.setSelectionCells(t)}),this.spinner.spin(document.body,mxResources.get("loading")))for(var c=t.length,f=c,x=[],v=mxUtils.bind(this,function(t,e){if(x[t]=e,0==--f){if(this.spinner.stop(),null!=o)o(x);else{var i=[];a.getModel().beginUpdate();try{for(var n=0;n<x.length;n++){var l=x[n]();null!=l&&(i=i.concat(l))}}finally{a.getModel().endUpdate()}}s(i)}}),y=0;y<c;y++)mxUtils.bind(this,function(s){var o=t[s],a=new FileReader;a.onload=mxUtils.bind(this,function(t){if(null==r||r(o))if("image/"==o.type.substring(0,6))if("image/svg"==o.type.substring(0,9)){var a=t.target.result,h=a.indexOf(","),c=atob(a.substring(h+1)),f=mxUtils.parseXml(c),x=f.getElementsByTagName("svg");if(x.length>0){var y=x[0],b=m?null:y.getAttribute("content");null!=b&&"<"!=b.charAt(0)&&"%"!=b.charAt(0)&&(b=unescape(window.atob?atob(b):Base64.decode(b,!0))),null!=b&&"%"==b.charAt(0)&&(b=decodeURIComponent(b)),null==b||"<mxfile "!==b.substring(0,8)&&"<mxGraphModel "!==b.substring(0,14)?v(s,mxUtils.bind(this,function(){try{a.substring(0,h+1);if(null!=f){var t=f.getElementsByTagName("svg");if(t.length>0){var r=t[0],d=parseFloat(r.getAttribute("width")),u=parseFloat(r.getAttribute("height")),m=r.getAttribute("viewBox");if(null==m||0==m.length)r.setAttribute("viewBox","0 0 "+d+" "+u);else if(isNaN(d)||isNaN(u)){var p=m.split(" ");p.length>3&&(d=parseFloat(p[2]),u=parseFloat(p[3]))}a=this.createSvgDataUri(mxUtils.getXml(t[0]));var c=Math.min(1,Math.min(n/Math.max(1,d)),n/Math.max(1,u));return l(a,o.type,e+s*g,i+s*g,Math.max(1,Math.round(d*c)),Math.max(1,Math.round(u*c)),o.name)}}}catch(t){}return null})):v(s,mxUtils.bind(this,function(){return l(b,"text/xml",e+s*g,i+s*g,0,0,o.name)}))}}else{var U=!1;if("image/png"==o.type){var C=m?null:this.extractGraphModelFromPng(t.target.result);if(null!=C&&C.length>0){var E=new Image;E.src=t.target.result,v(s,mxUtils.bind(this,function(){return l(C,"text/xml",e+s*g,i+s*g,E.width,E.height,o.name)})),U=!0}}U||(mxClient.IS_CHROMEAPP?(this.spinner.stop(),this.showError(mxResources.get("error"),mxResources.get("dragAndDropNotSupported"),mxResources.get("cancel"),mxUtils.bind(this,function(){}),null,mxResources.get("ok"),mxUtils.bind(this,function(){this.actions.get("import").funct()}))):this.loadImage(t.target.result,mxUtils.bind(this,function(r){this.resizeImage(r,t.target.result,mxUtils.bind(this,function(r,a,m){v(s,mxUtils.bind(this,function(){if(null!=r&&r.length<d){var h=p&&this.isResampleImage(t.target.result,u)?Math.min(1,Math.min(n/a,n/m)):1;return l(r,o.type,e+s*g,i+s*g,Math.round(a*h),Math.round(m*h),o.name)}return this.handleError({message:mxResources.get("imageTooBig")}),null}))}),p,n,u)})))}else l(t.target.result,o.type,e+s*g,i+s*g,240,160,o.name,function(t){v(s,function(){return t})})}),/(\.vsdx)($|\?)/i.test(o.name)||/(\.vssx)($|\?)/i.test(o.name)?l(null,o.type,e+s*g,i+s*g,240,160,o.name,function(t){v(s,function(){return t})},o):"image"==o.type.substring(0,5)?a.readAsDataURL(o):a.readAsText(o)})(y)});g?this.confirmImageResize(function(t){p=t,x()},a):x()},EditorUi.prototype.createSpinner=function(t,e,i){i=null!=i?i:24;var n=new Spinner({lines:12,length:i,width:Math.round(i/3),radius:Math.round(i/2),rotate:0,color:"#000",speed:1.5,trail:60,shadow:!1,hwaccel:!1,zIndex:2e9}),l=n.spin;n.spin=function(i,s){var r=!1;if(!this.active){if(l.call(this,i),this.active=!0,null!=s){var o=document.createElement("div");o.style.position="absolute",o.style.whiteSpace="nowrap",o.style.background="#4B4243",o.style.color="white",o.style.fontFamily="Helvetica, Arial",o.style.fontSize="9pt",o.style.padding="6px",o.style.paddingLeft="10px",o.style.paddingRight="10px",o.style.zIndex=2e9,o.style.left=Math.max(0,t)+"px",o.style.top=Math.max(0,e+70)+"px",mxUtils.setPrefixedStyle(o.style,"borderRadius","6px"),mxUtils.setPrefixedStyle(o.style,"boxShadow","2px 2px 3px 0px #ddd"),mxUtils.setPrefixedStyle(o.style,"transform","translate(-50%,-50%)"),o.innerHTML=s+"...",i.appendChild(o),n.status=o,mxClient.IS_VML&&(null==document.documentMode||document.documentMode<=8)&&(o.style.left=Math.round(Math.max(0,t-o.offsetWidth/2))+"px",o.style.top=Math.round(Math.max(0,e+70-o.offsetHeight/2))+"px")}this.pause=mxUtils.bind(this,function(){var t=function(){};return this.active&&(t=mxUtils.bind(this,function(){this.spin(i,s)})),this.stop(),t}),r=!0}return r};var s=n.stop;return n.stop=function(){s.call(this),this.active=!1,null!=n.status&&(n.status.parentNode.removeChild(n.status),n.status=null)},n.pause=function(){return function(){}},n},EditorUi.prototype.extractGraphModelFromPng=function(t){var e=null;try{var i=t.substring(t.indexOf(",")+1),n=window.atob&&!mxClient.IS_SF?atob(i):Base64.decode(i,!0);EditorUi.parsePng(n,mxUtils.bind(this,function(t,i,l){var s=n.substring(t+8,t+8+l);if("zTXt"==i){var r=s.indexOf(String.fromCharCode(0));if("mxGraphModel"==s.substring(0,r)){var o=this.editor.graph.bytesToString(pako.inflateRaw(s.substring(r+2))).replace(/\+/g," ");null!=o&&o.length>0&&(e=o)}}else if("tEXt"==i){var a=s.split(String.fromCharCode(0));a.length>1&&"mxGraphModel"==a[0]&&(e=a[1])}if(null!=e||"IDAT"==i)return!0}))}catch(t){}return null!=e&&"%"==e.charAt(0)&&(e=decodeURIComponent(e)),null!=e&&"%"==e.charAt(0)&&(e=decodeURIComponent(e)),e},EditorUi.prototype.loadImage=function(t,e,i){var n=new Image;n.onload=function(){e(n)},null!=i&&(n.onerror=i),n.src=t},EditorUi.prototype.resizeImage=function(t,e,i,n,l,s){l=null!=l?l:this.maxImageSize;var r=Math.max(1,t.width),o=Math.max(1,t.height);if(n&&this.isResampleImage(e,s))try{var a=Math.max(r/l,o/l);if(a>1){var d=Math.round(r/a),u=Math.round(o/a),m=document.createElement("canvas");m.width=d,m.height=u,m.getContext("2d").drawImage(t,0,0,d,u);var h=m.toDataURL();if(h.length<e.length){var p=document.createElement("canvas");p.width=d,p.height=u,h!==p.toDataURL()&&(e=h,r=d,o=u)}}}catch(t){}i(e,r,o)},EditorUi.prototype.isResampleImage=function(t,e){return e=null!=e?e:this.resampleThreshold,t.length>e},EditorUi.prototype.handleError=function(t,e,i){var n=null!=this.spinner&&null!=this.spinner.pause?this.spinner.pause():function(){},l=null!=t&&null!=t.error?t.error:t;if(null!=l||null!=e){var s=mxUtils.htmlEntities(mxResources.get("unknownError")),r=mxResources.get("ok"),o=null;if(e=null!=e?e:mxResources.get("error"),null!=l)if(null!=l.retry&&(r=mxResources.get("cancel"),o=function(){n(),l.retry()}),"undefined"!=typeof gapi&&void 0!==gapi.drive&&void 0!==gapi.drive.realtime&&l.type==gapi.drive.realtime.ErrorType.FORBIDDEN)s=mxUtils.htmlEntities(mxResources.get("forbidden"));else if(404==l.code||404==l.status||"undefined"!=typeof gapi&&void 0!==gapi.drive&&void 0!==gapi.drive.realtime&&l.type==gapi.drive.realtime.ErrorType.NOT_FOUND){s=mxUtils.htmlEntities(mxResources.get("fileNotFoundOrDenied"));var a=window.location.hash;null!=a&&"#G"==a.substring(0,2)&&(s+=' <a href="https://drive.google.com/open?id='+(a=a.substring(2))+'" target="_blank">'+mxUtils.htmlEntities(mxResources.get("tryOpeningViaThisPage"))+"</a>")}else l.code==Board.ERROR_TIMEOUT?s=mxUtils.htmlEntities(mxResources.get("timeout")):l.code==Board.ERROR_BUSY?s=mxUtils.htmlEntities(mxResources.get("busy")):null!=l.message?s=mxUtils.htmlEntities(l.message):null!=l.response&&null!=l.response.error&&(s=mxUtils.htmlEntities(l.response.error));this.showError(e,s,r,i,o)}else null!=i&&i()},EditorUi.prototype.showError=function(t,e,i,n,l,s,r){var o=new ErrorDialog(this,t,e,i,n,l,s,r);this.showDialog(o.container,340,150,!0,!1),o.init()},EditorUi.prototype.importFile=function(t,e,i,n,l,s,r,o,a,d,u){d=null==d||d;var m=!1,h=null;if("image"==e.substring(0,5)){var p=!1;if("image/png"==e.substring(0,9)){var g=u?null:this.extractGraphModelFromPng(t);null!=g&&g.length>0&&(h=this.importXml(g,i,n,d),p=!0)}if(!p){var c=this.editor.graph,f=t.indexOf(";");f>0&&(t=t.substring(0,f)+t.substring(t.indexOf(",",f+1))),d&&c.isGridEnabled()&&(i=c.snap(i),n=c.snap(n)),h=[c.insertVertex(null,null,"",i,n,l,s,"shape=image;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;verticalAlign=top;aspect=fixed;imageAspect=0;image="+t+";")]}}else!this.isOffline()&&(new XMLHttpRequest).upload&&this.isRemoteFileFormat(t,r)?(m=!0,this.parseFile(null!=a?a:new Blob([t],{type:"application/octet-stream"}),mxUtils.bind(this,function(t){if(4==t.readyState){var e=null;if(t.status>=200&&t.status<=299){var l=t.responseText;null!=l&&"<mxlibrary"==l.substring(0,10)?(null!=r&&".vssx"==r.toLowerCase().substring(r.length-5)&&(r=r.substring(0,r.length-5)+".xml"),this.loadLibrary(new LocalLibrary(this,l,r))):e=this.importXml(l,i,n,d)}null!=o&&o(e)}}),r)):/(\.vsd)($|\?)/i.test(r)||(h=this.insertTextAt(this.validateFileData(t),i,n,!0,null,d));return m||null==o||o(h),h},EditorUi.prototype.snapshoot=function(){new Audio(Board.CAMERA_SOUND).play()};